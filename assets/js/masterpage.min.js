var formatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}),searchRequest=null,productLimite=0,refreshLog=null,lang=window.navigator.language.substring(0,2),intervalContador=null,contador=0,estadoChat=!1,emitirSonido=!0,mensageRecibido="",messageInicial="";function countCartItem(){let e=JSON.parse(localStorage.getItem("currentCart"));e&&$(".qtyCart").html(Object.keys(e).length)}function switchLanguage(e){$.post(`${base_url}/assets/lang.json`,{},function(t){$(".changeLang").html(`<i class="bi bi-globe2"></i> ${t[e].buttonText}`);let a=t[e].home;$("#inputSearch").attr("placeholder",a.search),$(".link1").attr("placeholder",a.link1),$(".link2").attr("placeholder",a.link2),$(".link3").attr("placeholder",a.link3),$(".link1").html(a.link1),$(".link2").html(a.link2),$(".link3").html(a.link3),$(".link4").html(a.link4),$(".link5").html(a.link5),$(".bannerTittle").html(a.bannerTittle),$(".bannerSubTittle").html(a.bannerSubTittle),$(".ctaCall").html(a.ctaCall),$(".ctaMessage").html(a.ctaMessage),$(".ctaStoreTittle").html(a.ctaStoreTittle),$(".ctaStoreSubTittle").html(a.ctaStoreSubTittle),$(".subTittle").html(a.subTittle),$(".subSubTittle").html(a.subSubTittle),$("#btnSuscribe").val(a.btnSuscribe),$(".labelPurchase1").html(a.labelPurchase1),$(".labelPurchase2").html(a.labelPurchase2),document.title=a.pageTitle,a=t[e].chat,$(".labelChatTitle").html(a.chatTitle),$("#inputNameChat").attr("placeholder",a.inputName),$("#inputMail").attr("placeholder",a.inputMail),$("#inputPhone").attr("placeholder",a.inputPhone),$("#inputInitialMessage").attr("placeholder",a.inputInitialMessage),$("#btnStart").html(a.btnStart),$("#inputNewMessage").attr("placeholder",a.inputNewMessage),$("#btnSendmessage").html(a.btnSendmessage),$(".labelFinish").html(a.labelFinish),messageInicial=a.messageInicial,mensageRecibido=a.msgReceived})}function fnSuscribe(){let e={_method:"suscribe",email:$("#txtEmail").val()};$.post(`${base_url}/core/controllers/user.php`,e,function(e){$("#txtEmail").val(""),showAlert("success","you have successfully subscribed")})}function getConfig(e=!0){$.post(`${base_url}/core/controllers/setting.php`,{_method:"getUnique",parametro:"chat"},function(e){e.data&&(estadoChat=1==e.data.value),estadoChat?($("#divRegistro").addClass("d-none"),$("#divConversasion").removeClass("d-none"),$("#chatLog").removeClass("d-none"),$(".lblControl").removeClass("d-none")):($("#divRegistro").removeClass("d-none"),$("#divConversasion").addClass("d-none"),$("#chatLog").addClass("d-none"),$(".lblControl").addClass("d-none"))}).done(function(){let t=JSON.parse(localStorage.getItem("cliData"));t?($("#inputMail").val(t.mail),$("#inputNameChat").val(t.name),$("#divRegistro").addClass("d-none"),$("#divConversasion").removeClass("d-none"),$("#chatLog").removeClass("d-none"),$(".lblControl").removeClass("d-none"),loadLog(),refreshLog=setInterval(loadLog,2500)):estadoChat&&e&&(intervalContador=setInterval(function(){(contador+=1)>20&&(clearInterval(intervalContador),$("#check").is(":checked")||($(".chat-btn").click(),fnSaludoInicial()))},1e3))})}function registrarProspecto(){$("#chatLog").html(`<h5>${mensageRecibido}</h5>`).addClass("text-center");let e=new FormData;e.append("_method","POST"),e.append("leads",1),e.append("inputName",$("#inputNameChat").val()),e.append("inputLastname",""),e.append("inputAddress",""),e.append("inputAddress2",""),e.append("inputEmail",$("#inputMail").val()),e.append("inputPhone",$("#inputPhone").val()),e.append("inputCity",""),e.append("inputState",""),e.append("inputZip",""),e.append("inputInfo",""),e.append("clientId",0);var t=new XMLHttpRequest;t.open("POST","core/controllers/client.php"),t.send(e),sendContact()}function pad(e,t){return(e=e.toString()).length<t?pad("0"+e,t):e}function fnSaludoInicial(){objData={_method:"loadIpconfig"},$.post(`${base_url}/core/controllers/chat.php`,objData,function(e){let t=new Date,a=t.getHours()+":"+t.getMinutes(),n=JSON.stringify(e),o={message:messageInicial,email:"No email",name:"no name",phone:"No phone",ip:n,_method:"saludarIniciar",_time:a};$.post(`${base_url}/core/controllers/chat.php`,o,function(e){localStorage.setItem("cliData",JSON.stringify({name:"No name",mail:"No email",phone:"No phone",ip:n,chatId:e})),loadLog(),refreshLog=setInterval(loadLog,2500)})})}function fnSendMsg(){if(""==$("#inputNewMessage").val())return;let e=JSON.parse(localStorage.getItem("cliData")),t=JSON.parse(e.ip),a=new Date,n=a.getHours()+":"+a.getMinutes(),o={message:$("#inputNewMessage").val(),chatId:e.chatId,chatIp:t.ip,_method:"responseChat",_time:n};$.post(`${base_url}/core/controllers/chat.php`,o,function(){emitirSonido=!1,$("#inputNewMessage").val(""),loadLog()})}function loadLog(){let e={chatId:JSON.parse(localStorage.getItem("cliData")).chatId,_method:"loadLog"},t=$("#chatLog")[0].scrollHeight-20;$.post(`${base_url}/core/controllers/chat.php`,e,function(e){if(e){$("#chatLog").html(e.message);let a=$("#chatLog")[0].scrollHeight-20;if(a>t){if($("#chatLog").animate({scrollTop:a},"normal"),emitirSonido){new Audio(`${base_url}/assets/sound/bell.wav`).play()}emitirSonido=!0}}else $("#chatLog").html(""),clearInterval(refreshLog),localStorage.removeItem("cliData"),intervalContador=!0,contador=0,$(".chat-btn").click(),showAlert("info","Tech support decided to end the chat.")}).fail(function(){$("#chatLog").html("")})}function sendContact(){objData={_method:"loadIpconfig"},$.post(`${base_url}/core/controllers/chat.php`,objData,function(e){let t=new Date,a=t.getHours()+":"+t.getMinutes(),n=JSON.stringify(e),o={message:$("#inputInitialMessage").val(),email:$("#inputMail").val(),name:$("#inputNameChat").val(),phone:$("#inputPhone").val(),ip:n,chatIp:e.ip,_method:"dejarMensaje",_time:a};$.post(`${base_url}/core/controllers/chat.php`,o,function(e){$("#divRegistro").addClass("d-none"),$("#chatLog").removeClass("d-none")})})}function showAlert(e,t){Swal.fire({position:"top-end",icon:e,text:t,showConfirmButton:!1,timer:3e3})}function showConfirmation(e,t,a){return Swal.fire({title:e,text:t,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:a,allowOutsideClick:!1})}function updateIndicator(){window.navigator.onLine?(showAlert("success","The network connection has been restored"),loadLog(),refreshLog=setInterval(loadLog,2500)):(showAlert("error","The network connection has been lost"),clearInterval(refreshLog),$("#chatLog").html(""))}$(document).ready(function(){$(".nav-link").click(function(){let e=$(this).attr("href");window.location.replace(`${base_url}/${e}`)}),$("#btnStart").on("click",function(){if(0==$("#inputMail").val().length||0==$("#inputNameChat").val().length||0==$("#inputInitialMessage").val().length||0==$("#inputPhone").val().length)return!1;$("#chatLog").html(`<h5>${mensageRecibido}</h5>`).addClass("text-center"),registrarProspecto()}),$("#btnSendmessage").click(fnSendMsg),$(".lblControl").on("click",function(){(async()=>{if((await showConfirmation("Do you really want to end the chat with tech support?","","Yes")).isConfirmed){clearInterval(refreshLog);let e=new Date,t=e.getHours()+":"+e.getMinutes(),a=JSON.parse(localStorage.getItem("cliData")),n=JSON.parse(a.ip),o={chatId:a.chatId,ip:n.ip,_method:"closeChat",_time:t};$.post(`${base_url}/core/controllers/chat.php`,o,function(){$("#chatLog").html(""),localStorage.removeItem("cliData"),intervalContador=null,contador=0,getConfig(!1),$(".chat-btn").click()})}})()}),$(".linkChat").click(function(){$(".chat-btn").click()}),localStorage.getItem("currentLag")?lang=localStorage.getItem("currentLag"):localStorage.setItem("currentLag",lang),switchLanguage(lang),$("#inputSearch").keyup(function(){searchRequest&&searchRequest.abort(),searchRequest=$.ajax({url:`${base_url}/core/controllers/product.php`,method:"POST",data:{_method:"search",strQuery:$("#inputSearch").val()},success:function(e){let t="";$.each(e.data,function(e,a){let n=""!=a.thumbnail&&"0"!=a.thumbnail?`${base_url}/${a.thumbnail}`:`${base_url}/assets/img/default.jpg`;t+=`\n                                <li>\n                                    <a class="dropdown-item" href="${base_url}/product/index.php?pid=${a.id}">\n                                        <img src="${n}" alt="twbs" height="32" class="rounded flex-shrink-0 me-2">\n                                        ${"en"==lang?a.name:a.optional_name}\n                                    </a>\n                                </li>\n                            `}),$(".dropdown-menu").html(t).addClass("show")}})}),$("body").click(function(){searchRequest&&searchRequest.abort(),$(".dropdown-menu").html("").removeClass("show")}),$("#btnSuscribe").click(function(e){e.preventDefault(),""!=$("#txtEmail").val()&&fnSuscribe()}),getConfig(),$(".btnCheckout").click(function(){window.location.href=`${base_url}/checkout/index.php`}),countCartItem(),$("#check").change(function(){this.checked&&intervalContador&&contador<20&&(clearInterval(intervalContador),fnSaludoInicial())})}),window.addEventListener("online",updateIndicator),window.addEventListener("offline",updateIndicator);